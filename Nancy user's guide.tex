% Nancy User's Guide

\documentclass[english]{scrartcl}
\usepackage{babel,a4,newlfont,copyrght}
\usepackage[utf8]{inputenc}

% Alter some default parameters for general typesetting
\frenchspacing

% New commands
\renewcommand{\copyrightyear}{2006}

\begin{document}

\title{Nancy, a simple web site builder\\User's guide}
\date{\relax}
\author{Reuben Thomas}
\maketitle

\section{Introduction}

Nancy is a simple web site builder that glues together HTML fragments
to make pages, and allows fragments to be specialised for particular
pages.

\section{Environment}

Nancy is a command-line tool, typically used in a POSIX-like
environment. In particular, it takes arguments on the command line and
writes its output to standard output.

\section{Invocation}

Nancy takes three arguments:

\begin{verbatim}
nancy DIRECTORY ROOT-FRAGMENT SEARCH-PATH
\end{verbatim}

where \texttt{DIRECTORY} is the directory in which nancy operates,
\texttt{ROOT-FRAGMENT} is the HTML fragment to expand, and
\texttt{SEARCH-PATH} is the path, relative to \texttt{DIRECTORY},
which is searched for fragments. The resultant HTML page is printed to
standard output, so nancy is typically invoked as

\begin{verbatim}
nancy DIRECTORY ROOT-FRAGMENT SEARCH-PATH > PAGE
\end{verbatim}

in order to write the HTML output into the file \texttt{PAGE}.

If you supply the optional flag \verb|-list-fragments|, or \verb|-l|,
the fragments used will be listed on standard error.

\section{Operation}
\label{operation}

Nancy produces the finished page according to the following algorithm:

\begin{enumerate}
\item Change to the given \texttt{DIRECTORY}.
\item Set the initial text to \texttt{\$include\{ROOT-FRAGMENT\}}.
\item Repeatedly scan the text for an include command and replace it
  by the file it specifies, until no more include commands are
  found.\item Write out the resultant text.
\end{enumerate}

An include command consists of the string \texttt{\$include} followed
by a file argument in curly braces, e.g.
\texttt{\$include\{foo/bar.html\}}.

Only one guarantee is made about the order in which commands are
processed: if one command is nested inside another, the inner command
will be processed first. (Other than that, it does not actually matter
in which order commands are processed.)

To find the file \texttt{FILE\_PATH} specified by an include command,
nancy proceeds thus:

\begin{enumerate}
\item Look in \texttt{DIRECTORY/SEARCH\_PATH/FILE\_PATH}.
\item If the file is not found, remove the final directory from
  \texttt{SEARCH\_PATH} and try again, until \texttt{SEARCH\_PATH} is
  empty.\item Finally, try looking in \texttt{DIRECTORY/FILE\_PATH}.
\end{enumerate}

So, for example, if \texttt{DIRECTORY} is \texttt{/dir},
\texttt{SEARCH\_PATH} is \texttt{foo/bar/baz} and nancy is trying to
find \texttt{file.html}, it will try the following directories, in
order:

\begin{enumerate}
\item \texttt{/dir/foo/bar/baz/file.html}
\item \texttt{/dir/foo/bar/file.html}
\item \texttt{/dir/foo/file.html}
\item \texttt{/dir/file.html}
\end{enumerate}

This finishes the specification. There follows an example to clarify
the way that nancy is intended to be used.

\section{Example}

Suppose a web site with the following page design, from top to bottom:
logo, navigation menu, breadcrumb trail, page body.

Most of the elements are the same on each page, but the breadcrumb
trail has to show the canonical path to each page, and the logo is
bigger on the home page.

Suppose further that the web site has the following structure, where
each line corresponds to a page:

\begin{itemize}
\item Home page
\item People
  \begin{itemize}
  \item Jo Bloggs
  \item Hilary Pilary
  \item \dots
  \end{itemize}
\item Places
  \begin{itemize}
  \item Vladivostok
  \item Timbuktu
  \item \dots
  \end{itemize}
\end{itemize}

The basic page template looks something like this:

\begin{verbatim}
<html>
  <link href="style.css" rel="stylesheet" type="text/css">
  <title>$include{title}</title>
  <body>
    <div class="logo">$include{logo.html}</div>
    <div class="menu">$include{menu.html}</div>
    <div class="breadcrumb">$include{breadcrumb.html}</div>
    <div class="main">$include{main.html}</div>
  </body>
</html>
\end{verbatim}

Making the menu an include file is not strictly necessary, but, as in
programming, makes the HTML fragments easier to read. The pages will
be laid out as follows:

\begin{itemize}
\item \texttt{/}
  \begin{itemize}
  \item \texttt{index.html}
  \item \texttt{people/}
    \begin{itemize}
    \item \texttt{index.html}
    \item \texttt{jo\_bloggs.html}
    \item \texttt{hilary\_pilary.html}
    \end{itemize}
  \item \texttt{places/}
    \begin{itemize}
    \item \texttt{index.html}
    \item \texttt{vladivostok.html}
    \item \texttt{timbuktu.html}
    \end{itemize}
  \end{itemize}
\end{itemize}

The corresponding source files will be laid out as follows. This may
look a little confusing at first, but note the similarity to the HTML
pages, and hold on for the explanation!

\begin{itemize}
\item \texttt{source/}
  \begin{itemize}
  \item \texttt{template.html} (the template shown above)
  \item \texttt{menu.html}
  \item \texttt{logo.html}
  \item \texttt{breadcrumb.html}
  \item \texttt{index/}
    \begin{itemize}
    \item \texttt{main.html}
    \item \texttt{logo.html}
    \end{itemize}
  \item \texttt{people/}
    \begin{itemize}
    \item \texttt{main.html}
    \item \texttt{breadcrumb.html}
    \item \texttt{jo\_bloggs/}
      \begin{itemize}
      \item \texttt{main.html}
      \end{itemize}
    \item \texttt{hilary\_pilary/}
      \begin{itemize}
      \item \texttt{main.html}
      \end{itemize}
    \end{itemize}
  \item \texttt{places/}
    \begin{itemize}
    \item \texttt{main.html}
    \item \texttt{breadcrumb.html}
    \item \texttt{vladivostok/}
      \begin{itemize}
      \item \texttt{main.html}
      \end{itemize}
    \item \texttt{timbuktu/}
      \begin{itemize}
      \item \texttt{main.html}
      \end{itemize}
    \end{itemize}
  \end{itemize}
\end{itemize}

We could have used a different file suffix for page fragments, but
using \texttt{.html} is not too confusing, and means that editors and
other tools that might depend on the file suffix to treat the file
properly don't need special attention.

Note that there is only one menu fragment (the main menu is the same
for every page), while each section has its own breadcrumb trail
(\texttt{breadcrumb.html}), and each page has its own content
(\texttt{main.html}). Also, note that each page in the site has its
own directory (including the site index, which doesn't actually need
one, for consistency), so that each page can have fragments special to
it.

Now consider the invocation of nancy required to build the page whose
URL is \verb|http://www.example.org/places/vladivostok.html|:

\begin{verbatim}
nancy source template.html places/vladivostok \
        > dest/places/vladivostok.html
\end{verbatim}

(The backslash at the end of the first line indicates that the command
is really a single line, and has only been split for presentation
purposes.)

According to the rules given in section~\ref{operation}, this means
that nancy will look first for includes in
\texttt{source/places/vladivostok}, then in \texttt{source/places},
and finally in \texttt{source}. Hence, the actual list of files used
to assemble the page is:

\begin{itemize}
\item \texttt{source/template.html}
\item \texttt{source/logo.html}
\item \texttt{source/menu.html}
\item \texttt{source/places/breadcrumb.html}
\item \texttt{source/places/vladivostok/main.html}
\end{itemize}

For the site's index page, the file \texttt{index/logo.html} will be
used for the logo fragment, which can refer to the larger graphic
desired.

This scheme, though simple, is surprisingly flexible; this simple
example has covered all the standard techniques for nancy's use.

\end{document}

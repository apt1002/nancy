#!/bin/bash
# Tests for Nancy
# FIXME: add failure message

set -e

# FIXME: Common up the two tests

# One-tree test
rm -rf dest
NANCY_CMD="../nancy --verbose --root src template.html"
#NANCY_CMD="perl -wMDevel::SimpleTrace ../nancy --verbose --root src template.html"
mkdir dest
mkdir dest/people
for page in index.html people/index.html people/adam.html people/eve.html; do
    $NANCY_CMD $page > dest/$page
done
diff -Nur expected dest

# Two-tree test
rm -rf dest2
rm -rf src-merged
mkdir src-merged
./mergetrees src2:src src-merged
NANCY_CMD="../nancy --verbose --root src-merged template.html"
mkdir dest2
mkdir dest2/animals
for page in index.html animals/index.html animals/adam.html animals/eve.html; do
    $NANCY_CMD $page > dest2/$page
done
diff -Nur dest2 expected2
